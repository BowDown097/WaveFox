/* ---------------------------------------- Firefox 89 и новее ---------------------------------------- */
/* ---------------------------------------- Windows 10 / Windows 8 / Windows 7 ---------------------------------------- */

@media (-moz-os-version: windows-win10),
       (-moz-os-version: windows-win8),
       (-moz-os-version: windows-win7)
{

:root
{
    --my-left-svg: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100' style='fill:context-fill'><path d='m 0,100 c 16.666667,0 33.334333,0 41.667167,-16.666167 C 50,66.667667 50,33.334333 58.333833,16.667167 66.667667,0 83.333333,0 100,0 c 0,0 0,100 0,100 0,0 -100,0 -100,0 z'/></svg>");

    --my-right-svg: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100' style='fill:context-fill'><path d='M 100,100 C 83.333333,100 66.667667,100 58.333833,83.333833 50,66.667667 50,33.334333 41.667167,16.667167 33.334333,0 16.666667,0 0,0 c 0,0 0,100 0,100 0,0 100,0 100,0 z'/></svg>");

    --my-margin-top: 8px;

    --my-shadow-blur: 8px;
}

:root
{
    --lwt-accent-color: unset !important;

    --tab-selected-bgcolor: unset !important;

    --lwt-selected-tab-background-color: unset !important;

    --tabs-border-color: unset !important;
}

:root[uidensity="touch"]
{
    --tab-min-height: 42px !important;
}

/* ---------------------------------------- Цветовая схема ---------------------------------------- */

@media (prefers-color-scheme: light)
{
    :root:not(:-moz-lwtheme)
    {
        --my-background: linear-gradient(transparent, rgba(255,255,255,0.75));
    }

    :root[lwtheme-mozlightdark]
    {
        --my-shadow-color: rgba(0,0,0,0.1);
    }

    :root[lwtheme-mozlightdark]:-moz-lwtheme-brighttext
    {
        --my-shadow-color: rgba(0,0,0,0.5);
    }
}

@media (prefers-color-scheme: dark)
{
    :root[lwt-default-theme-in-dark-mode]
    {
        --my-background: linear-gradient(transparent, rgba(0,0,0,0.75));
    }

    :root[lwtheme-mozlightdark]
    {
        --my-shadow-color: rgba(0,0,0,0.5);
    }

    :root[lwtheme-mozlightdark]:-moz-lwtheme-darktext
    {
        --my-shadow-color: rgba(0,0,0,0.1);
    }
}

/* ---------------------------------------- Alpenglow ---------------------------------------- */

:root[lwt-selection]
{
    --lwt-background-tiling: no-repeat !important;
}

/* ---------------------------------------- Репозиторий ---------------------------------------- */

:root[lwtheme-image]
{
    --lwt-header-image: unset !important;
    --lwt-additional-images: unset !important;
}

/* ---------------------------------------- Закругленные углы (SVG) ---------------------------------------- */

.tab-background::before,
.tab-background::after
{
    content: "";
    position: absolute;
    width: var(--tab-min-height);
    height: var(--tab-min-height);
    bottom: 0%;
    fill: transparent;
    z-index: -1;
    background-repeat: no-repeat;
    pointer-events: none;
    -moz-context-properties: fill;
}

.tab-background::before
{
    right: 100%;
    background-image: var(--my-left-svg);
}

.tab-background::after
{
    left: 100%;
    background-image: var(--my-right-svg);
}

.tabbrowser-tab[selected] .tab-background::before,
.tabbrowser-tab[selected] .tab-background::after
{
    fill: var(--toolbar-bgcolor) !important;
}

.tabbrowser-tab:hover .tab-background::before,
.tabbrowser-tab:hover .tab-background::after
{
    fill: var(--toolbarbutton-hover-background);
}

.tabbrowser-tab[multiselected] .tab-background::before,
.tabbrowser-tab[multiselected] .tab-background::after
{
    fill: var(--toolbarbutton-active-background);
}

/* ---------------------------------------- Панель заголовка ---------------------------------------- */

:root[lwtheme-mozlightdark] #titlebar
{
    --toolbarbutton-icon-fill: currentColor;

    --toolbarbutton-hover-background: color-mix(in srgb, currentColor 10%, transparent) !important;

    --toolbarbutton-active-background: color-mix(in srgb, currentColor 20%, transparent) !important;
}

#titlebar
{
    position: relative;
    clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
}
    
#titlebar::before,
#titlebar::after
{
    content: "";
    position: absolute;
    width: 100%;
    height: 100%;
    left: 0%;
    bottom: 0%;
    background-repeat: no-repeat;
    pointer-events: none;
}
    
#titlebar::before
{
    z-index: 1;
}

#titlebar::after
{
    z-index: -1;
}

/* ---------------------------------------- Вкладки ---------------------------------------- */

.tabbrowser-tab
{
    margin-top: var(--my-margin-top) !important;
    padding-inline: unset !important;
    --tab-label-mask-size: 2em !important;
}

#tabbrowser-tabs[overflow] .tabbrowser-tab:is([selected],:hover,[multiselected]):not([pinned]) .tab-stack
{
    margin-inline: calc(var(--tab-min-height) / 2) !important;
}

:root:is(:not(:-moz-lwtheme),[lwt-default-theme-in-dark-mode]) .tabbrowser-tab:not([selected])
{
    color: inherit !important;
}

.tab-background
{
    position: relative !important;
    margin: 0 calc(var(--tab-min-height) / 2) !important;
    border: unset !important;
    border-radius: unset !important;
    box-shadow: unset !important;
    opacity: unset !important;
}

.tabbrowser-tab:hover:not([selected],[multiselected]) .tab-background
{
    background: var(--toolbarbutton-hover-background) !important;
}

.tabbrowser-tab[multiselected]:not([selected]) .tab-background
{
    background: var(--toolbarbutton-active-background) !important;
}

.tab-context-line
{
    margin: calc(var(--tab-min-height) - 2px) -6px 0 !important;
}

.tab-content[pinned]
{
    padding-inline: calc(var(--tab-min-height) / 3) !important;
}

.tab-loading-burst
{
    display: none !important;
}

.tab-close-button
{
    width: 24px !important;
    padding: 7px !important;
}

.tabbrowser-tab:is(:hover,[multiselected]):not([pinned]) .tab-close-button
{
    display: block !important;
}

/* ---------------------------------------- Панель вкладок ---------------------------------------- */

#TabsToolbar
{
    --toolbarbutton-inner-padding: unset !important;
}

#TabsToolbar .toolbarbutton-1
{
    margin-top: var(--my-margin-top) !important;
}

#TabsToolbar #search-container
{
    margin-top: var(--my-margin-top) !important;
    padding-block: unset !important;
}

#TabsToolbar #personal-bookmarks
{
    margin-top: var(--my-margin-top) !important;
}

.accessibility-indicator,
.private-browsing-indicator
{
    margin-top: var(--my-margin-top) !important;
}

#scrollbutton-up,
#scrollbutton-down
{
    margin-top: var(--my-margin-top) !important;
    padding: unset !important;
}

spacer[part="overflow-start-indicator"],
spacer[part="overflow-end-indicator"]
{
    margin-top: var(--my-margin-top) !important;
}

.titlebar-spacer[type="pre-tabs"]
{
    display: none !important;
}

/* ---------------------------------------- Отступы ---------------------------------------- */

#tabbrowser-tabs[haspinnedtabs]:not([overflow]) .tabbrowser-tab[first-visible-tab],
#tabbrowser-tabs[positionpinnedtabs],
.tabbrowser-tab[first-visible-unpinned-tab]
{
    margin-left: calc(var(--tab-min-height) / 2) !important;
}

.tabbrowser-tab[last-visible-tab]
{
    margin-right: calc(var(--tab-min-height) / 2) !important;
}

/* ---------------------------------------- Тени ---------------------------------------- */

.tabbrowser-tab[selected] .tab-background
{
    filter: drop-shadow(0 0 calc(var(--my-shadow-blur) / 2) var(--my-shadow-color));
}

#titlebar::before
{
    box-shadow: inset 0 calc(var(--my-shadow-blur) * -1) var(--my-shadow-blur) calc(var(--my-shadow-blur) * -1) var(--my-shadow-color);
}

/* ---------------------------------------- Разделители ---------------------------------------- */

.tabbrowser-tab:not([pinned])::before,
.tabbrowser-tab[last-visible-tab]:not([pinned])::after
{
    content: "";
    display: inherit;
    position: absolute;
    width: 1px;
    background: linear-gradient(transparent 25%, currentColor 25%, currentColor 75%, transparent 75%);
    opacity: 0.5;
}

.tabbrowser-tab:is([selected],
                   :hover,
                   :hover:not([pinned]) + .tabbrowser-tab,
                   [selected]:not([pinned]) + .tabbrowser-tab:not([selected]),
                   [multiselected])::before,
.tabbrowser-tab:is([selected],
                   [last-visible-tab]:not([pinned]):hover,
                   [multiselected])::after
{
    background: transparent;
}

.tabbrowser-tab::after
{
    margin-left: -1px;
}

/* ---------------------------------------- Windows 10 ---------------------------------------- */

@media (-moz-os-version: windows-win10)
{
    @media (-moz-windows-accent-color-in-titlebar: 0)
    {
        #titlebar::after
        {
            background: var(--my-background);
        }
    }

    @media (-moz-windows-accent-color-in-titlebar)
    {
        :root:is(:not(:-moz-lwtheme),[lwt-default-theme-in-dark-mode]) #titlebar
        {
            color: -moz-accent-color-foreground !important;
        }
    }

    #main-window
    {
        background: unset !important;
        appearance: auto;
        -moz-default-appearance: -moz-win-glass;
    }

    :root:not([lwt-selection]) .titlebar-buttonbox-container
    {
        opacity: 0 !important;
    }

    :root[sizemode="normal"] #navigator-toolbox
    {
        border-top: 1px solid transparent !important;
    }
}

/* ---------------------------------------- Windows 8 ---------------------------------------- */

@media (-moz-os-version: windows-win8)
{
    #titlebar::after
    {
        background: var(--my-background);
    }

    :root:not(:-moz-lwtheme) #titlebar
    {
        color: -moz-DialogText !important;
    }
}

/* ---------------------------------------- Windows 7 ---------------------------------------- */

@media (-moz-os-version: windows-win7)
{
    #titlebar::after
    {
        background: var(--my-background);
    }

    :root[lwtheme-mozlightdark] #TabsToolbar
    {
        background: unset !important;
    }

    :root:-moz-lwtheme #TabsToolbar
    {
        color: unset !important;
    }
}

}